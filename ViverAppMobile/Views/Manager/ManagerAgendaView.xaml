<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    x:Class="ViverAppMobile.Views.Manager.ManagerAgendaView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:ViverAppMobile.Controls"
    xmlns:converter="clr-namespace:ViverAppMobile.Converters"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:ViverAppMobile.ViewModels.Manager"
    x:Name="ManagerAgendaPage"
    BackgroundColor="{StaticResource PageBackground}">

    <ContentView.BindingContext>
        <vm:ManagerAgendaViewModel />
    </ContentView.BindingContext>

    <ContentView.Resources>
        <ResourceDictionary>
            <converter:SelectedValueToBoolConverter x:Key="SelectedValueToBoolConverter" />
            <converter:AppointmentTypeToStringConverter x:Key="AppointmentTypeToStringConverter" />
            <converter:AppointmentTypeToColorConverter x:Key="AppointmentTypeToColorConverter" />
            <converter:ScheduleStatusToStringConverter x:Key="ScheduleStatusToStringConverter" />
            <converter:ScheduleStatusToColorConverter x:Key="ScheduleStatusToColorConverter" />
            <converter:InverseBoolConverter x:Key="InverseBoolConverter" />
            <converter:DecimalToBrlMoneyConverter x:Key="DecimalToBrlMoneyConverter" />
            <converter:SByteToBoolConverter x:Key="SByteToBoolConverter" />
            <converter:InverseSbyteToBoolConverter x:Key="InverseSbyteToBoolConverter" />
            <converter:DateTimeToStringConverter x:Key="DateTimeToStringConveter" CurrentFormat="dddd, dd 'de' MMMM 'de' yyyy" />
            <converter:DateTimeToStringConverter x:Key="DateTimeWeekDayToStringConverter" CurrentFormat="dddd, dd 'de' MMMM 'de' yyyy 'às' HH:mm" />
            <converter:SByteToColorConverter x:Key="SByteToColorConverterBoxView" />
            <converter:DateOnlyToStringConverter x:Key="DateOnlyToStringConverter" CurrentFormat="age" />
            <converter:AppointmentTypeToStringConverter
                x:Key="AppointmentTypeToICONConverter"
                ConsultationText="&#xe811;"
                ExaminationText="&#xe817;"
                SurgeryText="&#xe806;" />
            <converter:SByteToStringConverter
                x:Key="SByteToStringConverter"
                TextForFalse="  [PAGO]"
                TextForTrue="" />
            <converter:SByteToColorConverter
                x:Key="SByteToPendingPaymentColorConverter"
                SelectedColor="Red"
                UnselectedColor="Green" />
        </ResourceDictionary>
    </ContentView.Resources>

    <RefreshView Command="{Binding ReloadPageCommand}" IsRefreshing="{Binding IsReloading}">
        <ScrollView>
            <VerticalStackLayout Padding="15" Spacing="20">
                <VerticalStackLayout Spacing="6">
                    <Label
                        FontFamily="Semibold"
                        FontSize="16"
                        HorizontalTextAlignment="Center"
                        Text="Gestão de Agendas" />
                    <Label
                        FontSize="13"
                        HorizontalTextAlignment="Center"
                        Text="Gerencie todos os agendamentos confirmados da clínica"
                        TextColor="Gray" />
                </VerticalStackLayout>

                <!--#region MainFilters-->
                <Border Padding="8" Style="{StaticResource MasterBorderStyle}">
                    <VerticalStackLayout Spacing="10">
                        <VerticalStackLayout Spacing="2">
                            <Label FontFamily="Semibold" FontSize="12">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span FontFamily="Semibold" Text="Exibindo a agenda " />
                                        <Span FontFamily="Semibold" Text="{Binding FilterTimePreposition}" />
                                        <Span FontFamily="Semibold" Text=":" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                            <Border
                                Margin="0,8,0,0"
                                Padding="0,3,0,3"
                                BackgroundColor="{StaticResource BackgroundGray}"
                                Stroke="Transparent"
                                StrokeShape="RoundRectangle 4">
                                <FlexLayout AlignItems="Center" Direction="Row">
                                    <Picker
                                        FlexLayout.Grow="1"
                                        FontSize="12"
                                        ItemsSource="{Binding FilterTimeOptions}"
                                        SelectedItem="{Binding SelectedFilterTime}" />
                                </FlexLayout>
                            </Border>
                        </VerticalStackLayout>

                        <Grid
                            ColumnDefinitions="*,*"
                            ColumnSpacing="20"
                            IsVisible="{Binding SelectedFilterTime, Converter={StaticResource SelectedValueToBoolConverter}, ConverterParameter=Personalizado}">
                            <StackLayout
                                Grid.Row="0"
                                Grid.Column="0"
                                Spacing="6">
                                <Label
                                    Margin="2,0,0,0"
                                    FontSize="12"
                                    Text="Data Inicial" />
                                <Border
                                    Padding="12,4,12,4"
                                    BackgroundColor="{StaticResource BackgroundGray}"
                                    StrokeShape="RoundRectangle 8"
                                    StrokeThickness="0.5">
                                    <FlexLayout AlignItems="Center">
                                        <controls:FullWidthDatePicker
                                            BackgroundColor="Transparent"
                                            Date="{Binding StartDateFilter}"
                                            FlexLayout.Basis="0%"
                                            FlexLayout.Grow="1"
                                            FontSize="12"
                                            HorizontalOptions="Fill"
                                            MaximumDate="{Binding EndDateFilter}"
                                            MinimumWidthRequest="0"
                                            VerticalOptions="Center">
                                            <controls:FullWidthDatePicker.Margin>
                                                <OnPlatform x:TypeArguments="Thickness">
                                                    <On Platform="Android" Value="0" />
                                                    <On Platform="WinUI" Value="-6,0,-6,0" />
                                                </OnPlatform>
                                            </controls:FullWidthDatePicker.Margin>
                                        </controls:FullWidthDatePicker>
                                    </FlexLayout>
                                </Border>
                            </StackLayout>
                            <StackLayout
                                Grid.Row="0"
                                Grid.Column="1"
                                Spacing="6">
                                <Label
                                    Margin="2,0,0,0"
                                    FontSize="12"
                                    Text="Data Final" />
                                <Border
                                    Padding="12,4,12,4"
                                    BackgroundColor="{StaticResource BackgroundGray}"
                                    StrokeShape="RoundRectangle 8"
                                    StrokeThickness="0.5">
                                    <FlexLayout AlignItems="Center">
                                        <controls:FullWidthDatePicker
                                            BackgroundColor="Transparent"
                                            Date="{Binding EndDateFilter}"
                                            FlexLayout.Basis="0%"
                                            FlexLayout.Grow="1"
                                            FontSize="12"
                                            HorizontalOptions="Fill"
                                            MinimumDate="{Binding StartDateFilter}"
                                            MinimumWidthRequest="0"
                                            VerticalOptions="Center">
                                            <controls:FullWidthDatePicker.Margin>
                                                <OnPlatform x:TypeArguments="Thickness">
                                                    <On Platform="Android" Value="0" />
                                                    <On Platform="WinUI" Value="-6,0,-6,0" />
                                                </OnPlatform>
                                            </controls:FullWidthDatePicker.Margin>
                                        </controls:FullWidthDatePicker>
                                    </FlexLayout>
                                </Border>
                            </StackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Border>
                <!--#endregion-->

                <!--#region DashBoard-->
                <Grid
                    ColumnDefinitions="*,*"
                    ColumnSpacing="10"
                    RowDefinitions="*,*"
                    RowSpacing="10">
                    <Border
                        Grid.Row="0"
                        Grid.Column="0"
                        Style="{StaticResource MasterBorderStyle}">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="4">
                            <Label
                                FontFamily="AppIcons"
                                FontSize="16"
                                HorizontalTextAlignment="Center"
                                Text="&#xe821;"
                                TextColor="Purple" />
                            <Label
                                FontFamily="Semibold"
                                FontSize="18"
                                HorizontalTextAlignment="Center"
                                Text="{Binding OnlineTot}"
                                TextColor="Purple" />
                            <Label FontSize="12">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="Online " />
                                        <Span Text="{Binding SelectedFilterTimeTermination}" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </VerticalStackLayout>
                    </Border>
                    <Border
                        Grid.Row="0"
                        Grid.Column="1"
                        Style="{StaticResource MasterBorderStyle}">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="4">
                            <Label
                                FontFamily="AppIcons"
                                FontSize="20"
                                HorizontalTextAlignment="Center"
                                Text="&#xf0f7;"
                                TextColor="Green" />
                            <Label
                                FontFamily="Semibold"
                                FontSize="18"
                                HorizontalTextAlignment="Center"
                                Text="{Binding PresencialTot}"
                                TextColor="Green" />
                            <Label FontSize="12">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="Presencial " />
                                        <Span Text="{Binding SelectedFilterTimeTermination}" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </VerticalStackLayout>
                    </Border>
                    <Border
                        Grid.Row="1"
                        Grid.Column="0"
                        BackgroundColor="#fff7ed"
                        Stroke="OrangeRed"
                        StrokeThickness="0.3"
                        Style="{StaticResource MasterBorderStyle}">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="4">
                            <Label
                                FontFamily="AppIcons"
                                FontSize="20"
                                HorizontalTextAlignment="Center"
                                Text="&#xf0ec;"
                                TextColor="OrangeRed" />
                            <Label
                                FontFamily="Semibold"
                                FontSize="18"
                                HorizontalTextAlignment="Center"
                                Text="{Binding RescheduleTot}"
                                TextColor="DarkRed" />
                            <Label FontSize="12" HorizontalTextAlignment="Center">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="Remarcados " />
                                        <Span Text="{Binding SelectedFilterTimeTerminationReschedule}" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </VerticalStackLayout>
                    </Border>
                    <Border
                        Grid.Row="1"
                        Grid.Column="1"
                        Style="{StaticResource MasterBorderStyle}">
                        <VerticalStackLayout HorizontalOptions="Center" Spacing="4">
                            <Label
                                FontFamily="AppIcons"
                                FontSize="20"
                                HorizontalTextAlignment="Center"
                                Text="&#xf133;"
                                TextColor="Blue" />
                            <Label
                                FontFamily="Semibold"
                                FontSize="18"
                                HorizontalTextAlignment="Center"
                                Text="{Binding GeneralTot}"
                                TextColor="Blue" />
                            <Label FontSize="12">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="Total " />
                                        <Span Text="{Binding SelectedFilterTimeTermination}" />
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </VerticalStackLayout>
                    </Border>
                </Grid>
                <!--#endregion-->

                <!--#region AdvancedFilters-->
                <Border
                    Padding="10"
                    BackgroundColor="White"
                    StrokeShape="RoundRectangle 8">
                    <toolkit:Expander x:Name="FilterExpander" ExpandedChanged="FilterExpander_ExpandedChanged">
                        <toolkit:Expander.Header>
                            <FlexLayout Direction="Row" JustifyContent="SpaceBetween">
                                <Label FontSize="12">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span FontFamily="AppIcons" Text="&#xe810;" />
                                            <Span Text="  Filtros" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                                <Label
                                    x:Name="FiltersIconLabelExpand"
                                    ClassId="IconLabelExpand"
                                    FontFamily="AppIcons"
                                    FontSize="12"
                                    Text="&#xe80e;"
                                    TextColor="Black" />
                            </FlexLayout>
                        </toolkit:Expander.Header>

                        <toolkit:Expander.Content>
                            <VerticalStackLayout Margin="0,20,0,0" Spacing="10">
                                <Border
                                    Padding="0,-6"
                                    BackgroundColor="{StaticResource BackgroundGray}"
                                    Stroke="Transparent"
                                    StrokeShape="RoundRectangle 8">
                                    <SearchBar
                                        FontSize="13"
                                        Placeholder="Buscar pelo nome do paciente ou nome do serviço...."
                                        PlaceholderColor="Gray"
                                        SearchCommand="{Binding FilterByStringCommand}"
                                        Text="{Binding FilterString}" />
                                </Border>

                                <VerticalStackLayout Spacing="2">
                                    <Label
                                        FontFamily="Semibold"
                                        FontSize="12"
                                        Text="Modalidade" />
                                    <Border
                                        Padding="0,-8"
                                        BackgroundColor="{StaticResource BackgroundGray}"
                                        Stroke="Transparent"
                                        StrokeShape="RoundRectangle 8">
                                        <Picker
                                            FontSize="12"
                                            ItemsSource="{Binding FilterModalityOptions}"
                                            SelectedItem="{Binding SelectedModalityFilter}"
                                            TextColor="Gray" />
                                    </Border>
                                </VerticalStackLayout>

                                <VerticalStackLayout Spacing="2">
                                    <Label
                                        FontFamily="Semibold"
                                        FontSize="12"
                                        Text="Tipo de Atendimento" />
                                    <Border
                                        Padding="0,-8"
                                        BackgroundColor="{StaticResource BackgroundGray}"
                                        Stroke="Transparent"
                                        StrokeShape="RoundRectangle 8">
                                        <Picker
                                            FontSize="12"
                                            ItemsSource="{Binding FilterAppointmentTypes}"
                                            SelectedItem="{Binding SelectedAppointmentTypeFilter}"
                                            TextColor="Gray" />
                                    </Border>
                                </VerticalStackLayout>

                                <VerticalStackLayout Spacing="2">
                                    <Label
                                        FontFamily="Semibold"
                                        FontSize="12"
                                        Text="Médico(a) do Atendimento" />
                                    <Border
                                        Padding="0,-8"
                                        BackgroundColor="{StaticResource BackgroundGray}"
                                        Stroke="Transparent"
                                        StrokeShape="RoundRectangle 8">
                                        <Picker
                                            FontSize="12"
                                            ItemsSource="{Binding ActiveDoctors}"
                                            SelectedItem="{Binding SelectedDoctorFilter}"
                                            TextColor="Gray" />
                                    </Border>
                                </VerticalStackLayout>

                                <VerticalStackLayout Spacing="2">
                                    <Label
                                        FontFamily="Semibold"
                                        FontSize="12"
                                        Text="Status do Pagamento" />
                                    <Border
                                        Padding="0,-8"
                                        BackgroundColor="{StaticResource BackgroundGray}"
                                        Stroke="Transparent"
                                        StrokeShape="RoundRectangle 8">
                                        <Picker
                                            FontSize="12"
                                            ItemsSource="{Binding FilterSchedulePaid}"
                                            SelectedItem="{Binding SelectedSchedulePaid}"
                                            TextColor="Gray" />
                                    </Border>
                                </VerticalStackLayout>

                                <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                                    <VerticalStackLayout Grid.Column="0" Spacing="2">
                                        <Label
                                            Margin="4,0,0,0"
                                            FontFamily="Semibold"
                                            FontSize="12"
                                            Text="Hora Inicial" />
                                        <controls:CustomTimePicker
                                            HeightRequest="26"
                                            Time="{Binding StartTimeFilter}"
                                            WidthRequest="160" />
                                    </VerticalStackLayout>
                                    <VerticalStackLayout Grid.Column="1" Spacing="2">
                                        <Label
                                            Margin="4,0,0,0"
                                            FontFamily="Semibold"
                                            FontSize="12"
                                            Text="Hora Final" />
                                        <controls:CustomTimePicker
                                            HeightRequest="26"
                                            Time="{Binding EndTimeFilter}"
                                            WidthRequest="160" />
                                    </VerticalStackLayout>
                                </Grid>

                                <Border
                                    Margin="0,10,0,0"
                                    Padding="6"
                                    Style="{StaticResource MasterBorderStyle}">

                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding ClearFiltersCommand}" CommandParameter="{StaticResource TrueParam}" />
                                    </Border.GestureRecognizers>

                                    <Label
                                        FontSize="12"
                                        HorizontalTextAlignment="Center"
                                        TextColor="Red">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span FontFamily="AppIcons" Text="&#xe80a;" />
                                                <Span FontFamily="Semibold" Text="  Limpar Filtros" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                </Border>
                            </VerticalStackLayout>
                        </toolkit:Expander.Content>
                    </toolkit:Expander>
                </Border>
                <!--#endregion-->

                <!--#region ScheduleCollection-->
                <CollectionView ItemSizingStrategy="MeasureAllItems" ItemsSource="{Binding ConfirmedSchedule}">
                    <CollectionView.EmptyView>
                        <ContentView BindingContext="Ops... Não foi encontrado nenhum atendimento. Verifique os filtros de busca" ControlTemplate="{StaticResource EmptyStateTemplate}" />
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="5,5,0,15">
                                <controls:GradientBoxView
                                    Margin="-6,0,0,0"
                                    CornerRadius="10"
                                    EndColor="{Binding IsOnline, Converter={StaticResource SByteToColorConverterBoxView}}"
                                    GradientDirection="Vertical"
                                    Opacity="0.8"
                                    StartColor="{Binding PendingPayment, Converter={StaticResource SByteToPendingPaymentColorConverter}}" />
                                <Border
                                    Padding="15"
                                    BackgroundColor="White"
                                    Stroke="LightGray"
                                    StrokeShape="RoundRectangle 10"
                                    StrokeThickness="0.5">
                                    <Grid RowDefinitions="*,Auto,Auto" RowSpacing="6">
                                        <VerticalStackLayout Grid.Row="0" Spacing="8">
                                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                                                <Border
                                                    Grid.Column="0"
                                                    Padding="10"
                                                    BackgroundColor="{Binding AppointmentType, Converter={StaticResource AppointmentTypeToColorConverter}}"
                                                    Stroke="Transparent"
                                                    StrokeShape="RoundRectangle 40">
                                                    <Label
                                                        FontFamily="AppIcons"
                                                        FontSize="20"
                                                        Text="{Binding AppointmentType, FallbackValue='N/A', TargetNullValue='N/A', Converter={StaticResource AppointmentTypeToICONConverter}}"
                                                        TextColor="White"
                                                        VerticalTextAlignment="Center" />
                                                </Border>
                                                <StackLayout Grid.Column="1" Spacing="3">
                                                    <Label FontAttributes="Bold" FontSize="14">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span FontAttributes="Bold" Text="Paciente: " />
                                                                <Span FontAttributes="Bold" Text="{Binding UserName}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                    <Label FontAttributes="Bold" FontSize="12">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span FontAttributes="Bold" Text="Especialista: " />
                                                                <Span Text="{Binding ProfessionalDoctorName}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                    <Label FontAttributes="Bold" FontSize="12">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span FontAttributes="Bold" Text="Idade: " />
                                                                <Span Text="{Binding PatientBirthDate, Converter={StaticResource DateOnlyToStringConverter}}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                    <Label FontAttributes="Bold" FontSize="12">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span FontAttributes="Bold" Text="Agendamento: " />
                                                                <Span Text="{Binding AppointmentTitle}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </StackLayout>
                                                <StackLayout Grid.Column="2" Spacing="6">
                                                    <Border StrokeShape="RoundRectangle 4" StrokeThickness="0.5">
                                                        <Label
                                                            Padding="5,2,5,2"
                                                            FontSize="12"
                                                            HorizontalTextAlignment="Center"
                                                            Text="{Binding AppointmentType, FallbackValue='N/A', TargetNullValue='N/A', Converter={StaticResource AppointmentTypeToStringConverter}}"
                                                            VerticalTextAlignment="Center" />
                                                    </Border>
                                                    <Border
                                                        BackgroundColor="#dcfce8"
                                                        Stroke="Transparent"
                                                        StrokeShape="RoundRectangle 4">
                                                        <Label
                                                            Padding="5,2,5,2"
                                                            FontSize="12"
                                                            HorizontalTextAlignment="Center"
                                                            Text="Confirmado"
                                                            VerticalTextAlignment="Center" />
                                                    </Border>
                                                </StackLayout>
                                            </Grid>

                                            <Border
                                                Padding="3,0,0,0"
                                                BackgroundColor="Red"
                                                IsVisible="{Binding PendingPayment, Converter={StaticResource SByteToBoolConverter}}"
                                                StrokeThickness="0">
                                                <Border
                                                    Padding="10"
                                                    BackgroundColor="#fef2f2"
                                                    StrokeThickness="0">
                                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                                                        <Label
                                                            Grid.Column="0"
                                                            FontFamily="AppIcons"
                                                            Text="&#xf155;"
                                                            TextColor="Red"
                                                            VerticalTextAlignment="Center" />
                                                        <StackLayout Grid.Column="1" Spacing="3">
                                                            <Label
                                                                FontAttributes="Bold"
                                                                FontSize="12"
                                                                Text="Pagamento pendente"
                                                                TextColor="DarkRed" />
                                                            <Label
                                                                FontSize="11"
                                                                Text="Atendimento confirmado, mas aguardando pagamento"
                                                                TextColor="DarkRed" />
                                                        </StackLayout>
                                                    </Grid>
                                                </Border>
                                            </Border>

                                            <Border
                                                Padding="3,0,0,0"
                                                BackgroundColor="DarkOrange"
                                                IsVisible="{Binding Rescheduled, Converter={StaticResource SByteToBoolConverter}}"
                                                StrokeThickness="0">
                                                <Border
                                                    Padding="10,18,18,18"
                                                    BackgroundColor="#fff7ed"
                                                    StrokeThickness="0">
                                                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="6">
                                                        <Label
                                                            Grid.Column="0"
                                                            FontFamily="AppIcons"
                                                            Text="&#xe81c;"
                                                            TextColor="DarkOrange"
                                                            VerticalTextAlignment="Center" />
                                                        <StackLayout Grid.Column="1" Spacing="5">
                                                            <Label FontSize="12" TextColor="DarkRed">
                                                                <Label.FormattedText>
                                                                    <FormattedString>
                                                                        <Span FontAttributes="Bold" Text="Atendimento " />
                                                                        <Span FontAttributes="Bold" Text="{Binding Source={StaticResource RescheduledStatus}, FallbackValue='N/A', TargetNullValue='N/A', Converter={StaticResource ScheduleStatusToStringConverter}}" />
                                                                    </FormattedString>
                                                                </Label.FormattedText>
                                                            </Label>
                                                            <Label FontSize="10" TextColor="DarkRed">
                                                                <Label.FormattedText>
                                                                    <FormattedString>
                                                                        <Span Text="Data Original: " />
                                                                        <Span Text="{Binding OriginalDate, FallbackValue='N/A', TargetNullValue='N/A', Converter={StaticResource DateTimeToStringConveter}}" />
                                                                    </FormattedString>
                                                                </Label.FormattedText>
                                                            </Label>
                                                        </StackLayout>
                                                        <Border
                                                            Grid.Column="2"
                                                            Padding="10,2,10,2"
                                                            BackgroundColor="#ffedd4"
                                                            HeightRequest="25"
                                                            Stroke="Transparent"
                                                            StrokeShape="RoundRectangle 8">
                                                            <Label
                                                                FontSize="11"
                                                                TextColor="DarkRed"
                                                                VerticalTextAlignment="Center">
                                                                <Label.FormattedText>
                                                                    <FormattedString>
                                                                        <Span FontFamily="AppIcons" Text="&#xf0ec;" />
                                                                        <Span Text="  Reagendado" />
                                                                    </FormattedString>
                                                                </Label.FormattedText>
                                                            </Label>
                                                        </Border>
                                                    </Grid>
                                                </Border>
                                            </Border>

                                            <Border
                                                Padding="15"
                                                BackgroundColor="#f9fafb"
                                                Stroke="Transparent"
                                                StrokeShape="RoundRectangle 8">
                                                <StackLayout Spacing="8">
                                                    <Label FontSize="12" TextColor="Black">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span FontFamily="AppIcons" Text="&#xf133;" />
                                                                <Span Text="    " />
                                                                <Span Text="{Binding AppointmentDate, FallbackValue='N/A', TargetNullValue='N/A', Converter={StaticResource DateTimeWeekDayToStringConverter}}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                    <Label FontSize="12" TextColor="Black">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span FontFamily="AppIcons" Text="&#xe801;" />
                                                                <Span Text="    Duração estimada: " />
                                                                <Span Text="{Binding AverageTime, FallbackValue='N/A', TargetNullValue='N/A'}" />
                                                                <Span Text=" hrs" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="16">
                                                        <Label
                                                            Grid.Column="0"
                                                            FontFamily="AppIcons"
                                                            FontSize="12"
                                                            IsVisible="{Binding IsOnline, Converter={StaticResource InverseSbyteToBoolConverter}}"
                                                            Text="&#xe800;"
                                                            TextColor="CornflowerBlue"
                                                            VerticalTextAlignment="Center" />
                                                        <Label
                                                            Grid.Column="0"
                                                            FontFamily="AppIcons"
                                                            FontSize="10"
                                                            HorizontalTextAlignment="Start"
                                                            IsVisible="{Binding IsOnline, Converter={StaticResource SByteToBoolConverter}}"
                                                            Text="&#xe802;"
                                                            TextColor="Purple"
                                                            VerticalTextAlignment="Center" />
                                                        <StackLayout
                                                            Grid.Column="1"
                                                            IsVisible="{Binding IsOnline, Converter={StaticResource InverseSbyteToBoolConverter}}"
                                                            Spacing="2">
                                                            <Label FontSize="12">
                                                                <Label.FormattedText>
                                                                    <FormattedString>
                                                                        <Span Text="{Binding ClinicFantasyName, FallbackValue='N/A', TargetNullValue='N/A'}" />
                                                                        <Span Text=" - " />
                                                                        <Span Text="{Binding ClinicComplement, FallbackValue='N/A', TargetNullValue='N/A'}" />
                                                                    </FormattedString>
                                                                </Label.FormattedText>
                                                            </Label>
                                                            <Label FontSize="11" TextColor="Gray">
                                                                <Label.FormattedText>
                                                                    <FormattedString>
                                                                        <Span Text="{Binding ClinicAdress, FallbackValue='N/A', TargetNullValue='N/A'}" />
                                                                        <Span Text=", " />
                                                                        <Span Text="{Binding ClinicNumber, FallbackValue='N/A', TargetNullValue='N/A'}" />
                                                                        <Span Text=" - " />
                                                                        <Span Text="{Binding ClinicNeighborhood, FallbackValue='N/A', TargetNullValue='N/A'}" />
                                                                        <Span Text=", " />
                                                                        <Span Text="{Binding ClinicCity, FallbackValue='N/A', TargetNullValue='N/A'}" />
                                                                        <Span Text=" - " />
                                                                        <Span Text="{Binding ClinicState, FallbackValue='N/A', TargetNullValue='N/A'}" />
                                                                    </FormattedString>
                                                                </Label.FormattedText>
                                                            </Label>
                                                        </StackLayout>
                                                        <Label
                                                            Grid.Column="1"
                                                            FontSize="12"
                                                            IsVisible="{Binding IsOnline, Converter={StaticResource SByteToBoolConverter}}"
                                                            Text="Consulta online"
                                                            TextColor="Purple" />

                                                    </Grid>
                                                    <Label FontSize="12" TextColor="{Binding PendingPayment, Converter={StaticResource SByteToPendingPaymentColorConverter}}">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span FontFamily="AppIcons" Text="&#xe805;" />
                                                                <Span Text="     " />
                                                                <Span Text="{Binding AppointmentPrice, FallbackValue='N/A', TargetNullValue='N/A', Converter={StaticResource DecimalToBrlMoneyConverter}}" />
                                                                <Span Text="{Binding PendingPayment, Converter={StaticResource SByteToStringConverter}}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </StackLayout>
                                            </Border>

                                            <Grid Padding="5,5,0,5">
                                                <BoxView Margin="-3,0,0,0" Color="CornflowerBlue" />
                                                <Border
                                                    Padding="12"
                                                    Background="{StaticResource BackgroundBlue}"
                                                    Stroke="Transparent">
                                                    <Label FontSize="12" TextColor="MediumBlue">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span FontAttributes="Bold" Text="Observações: " />
                                                                <Span Text="{Binding Obs, FallbackValue='N/A', TargetNullValue='N/A'}" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </Border>
                                            </Grid>
                                        </VerticalStackLayout>

                                        <Grid
                                            Grid.Row="1"
                                            ColumnDefinitions="*,*"
                                            ColumnSpacing="10"
                                            RowDefinitions="*,*"
                                            RowSpacing="6">
                                            <Border
                                                Grid.Row="0"
                                                Grid.Column="0"
                                                Padding="0,5,0,5"
                                                BackgroundColor="White"
                                                Stroke="#CCCCCC"
                                                StrokeShape="RoundRectangle 8">

                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding BindingContext.CallToPacientCommand, Source={x:Reference ManagerAgendaPage}}" CommandParameter="{Binding .}" />
                                                </Border.GestureRecognizers>

                                                <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                                                    <Label
                                                        FontFamily="AppIcons"
                                                        FontSize="12"
                                                        HorizontalTextAlignment="Center"
                                                        Text="&#xe804;"
                                                        TextColor="Black"
                                                        VerticalTextAlignment="Center" />
                                                    <Label
                                                        FontSize="12"
                                                        HorizontalTextAlignment="Center"
                                                        Text="Ligar"
                                                        TextColor="Black"
                                                        VerticalTextAlignment="Center" />
                                                </HorizontalStackLayout>
                                            </Border>
                                            <Border
                                                Grid.Row="0"
                                                Grid.Column="1"
                                                Padding="0,5,0,5"
                                                BackgroundColor="Black"
                                                Stroke="#CCCCCC"
                                                StrokeShape="RoundRectangle 8">

                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding BindingContext.ShowDetailsCommand, Source={x:Reference ManagerAgendaPage}}" CommandParameter="{Binding .}" />
                                                </Border.GestureRecognizers>

                                                <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                                                    <Label
                                                        FontFamily="AppIcons"
                                                        FontSize="12"
                                                        HorizontalTextAlignment="Center"
                                                        Text="&#xe836;"
                                                        TextColor="White"
                                                        VerticalTextAlignment="Center" />
                                                    <Label
                                                        FontSize="12"
                                                        HorizontalTextAlignment="Center"
                                                        Text="Detalhes"
                                                        TextColor="White"
                                                        VerticalTextAlignment="Center" />
                                                </HorizontalStackLayout>
                                            </Border>
                                            <Border
                                                Grid.Row="1"
                                                Grid.Column="0"
                                                Padding="0,5,0,5"
                                                BackgroundColor="White"
                                                Stroke="#CCCCCC"
                                                StrokeShape="RoundRectangle 8">

                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding BindingContext.RescheduleCommand, Source={x:Reference ManagerAgendaPage}}" CommandParameter="{Binding .}" />
                                                </Border.GestureRecognizers>

                                                <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                                                    <Label
                                                        FontFamily="AppIcons"
                                                        FontSize="12"
                                                        HorizontalTextAlignment="Center"
                                                        Text="&#xe80b;"
                                                        TextColor="CornflowerBlue"
                                                        VerticalTextAlignment="Center" />
                                                    <Label
                                                        FontSize="12"
                                                        HorizontalTextAlignment="Center"
                                                        Text="Remarcar"
                                                        TextColor="CornflowerBlue"
                                                        VerticalTextAlignment="Center" />
                                                </HorizontalStackLayout>
                                            </Border>
                                            <Border
                                                Grid.Row="1"
                                                Grid.Column="1"
                                                Padding="0,5,0,5"
                                                BackgroundColor="White"
                                                Stroke="#CCCCCC"
                                                StrokeShape="RoundRectangle 8">

                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding BindingContext.CancelScheduleCommand, Source={x:Reference ManagerAgendaPage}}" CommandParameter="{Binding .}" />
                                                </Border.GestureRecognizers>

                                                <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                                                    <Label
                                                        FontFamily="AppIcons"
                                                        FontSize="12"
                                                        HorizontalTextAlignment="Center"
                                                        Text="&#xe80a;"
                                                        TextColor="Red"
                                                        VerticalTextAlignment="Center" />
                                                    <Label
                                                        FontSize="12"
                                                        HorizontalTextAlignment="Center"
                                                        Text="Cancelar"
                                                        TextColor="Red"
                                                        VerticalTextAlignment="Center" />
                                                </HorizontalStackLayout>
                                            </Border>
                                        </Grid>

                                        <Border
                                            Grid.Row="2"
                                            Padding="8,6,8,6"
                                            BackgroundColor="Green"
                                            IsVisible="{Binding PendingPayment, Converter={StaticResource SByteToBoolConverter}}"
                                            Stroke="Transparent"
                                            StrokeShape="RoundRectangle 6">

                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding BindingContext.ConfirmPaymentCommand, Source={x:Reference ManagerAgendaPage}}" CommandParameter="{Binding .}" />
                                            </Border.GestureRecognizers>

                                            <Label
                                                FontSize="12"
                                                HorizontalTextAlignment="Center"
                                                TextColor="White">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span FontFamily="AppIcons" Text="&#xe803;" />
                                                        <Span Text="  Confirmar Pagamento" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                        </Border>
                                    </Grid>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
                <!--#endregion-->
            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>
</ContentView>
